{extend name=".././view/create.html" /}

{block name="jscss"}
  <style>
    .dh {
      min-height:50px;
      size:24px;
      padding-top:10px;
      text-align:center;
      min-height: 30px;
      float: left;
      margin-right: 1px;
    }
    .wancheng {
      border-bottom: 3px solid #01AAED;
    }

    .jinxing {
      border-bottom: 3px solid #FF5722;
    }

    .weicaozuo {
      border-bottom: 3px solid #FFB800;
    }
  </style>
{/block}

{block name="form"}
<div class="layui-form-item">
  <div class="dh wancheng" style="width: 10%;">开始</div>
  <div class="dh wancheng" style="width: 20%;">考试信息</div>
  <div class="dh wancheng" style="width: 30%;">各年级参加考试学科和分数线</div>
  <div class="dh jinxing" style="width: 30%;">生成参加考试学生名单</div>
  <div class="dh weicaozuo" style="width: 9%;">完成</div>
</div>
<form class="layui-form layui-form-pane" lay-filter="myform">
  <div class="layui-form-item">
    <label for="school_id" class="layui-form-label"><span class="x-red">*</span>参考学校</label>
    <div class="layui-input-block">
      {php}$schoolList = danweiJibie('校级', '校级');{/php}
      <select name="school_id" id="school_id" lay-filter="school_id" lay-verify="required">
        <option value="">请选择学校</option>
        {foreach $schoolList as $key=>$vo }
        <option value="{$vo.id}">
        {$vo.title}
      </option>
      {/foreach}
    </select>
  </div>
</div>
<div class="layui-form-item">
  {foreach $list.data.nianji as $key=>$vo }
  <label for="title" class="layui-form-label" title="nianji">{$vo.nianjiname}</label>
  <div class="layui-input-block" id="{$vo.ruxuenian}">
   <input type="checkbox" title="全选" lay-skin="primary"  checkall="p">
 </div>
 {/foreach}
</div>
<input type="hidden" name="kaoshi_id" id="kaoshi_id" value="{$list.set.kaoshi_id}">
<div class="layui-form-item" style="text-align: right;">
  <button  class="layui-btn" lay-filter="kssubmit" lay-submit="">
    {$list.set.butname}
  </button>
  <a href="javascript:;" onclick="nextSet()" class="layui-btn layui-btn-danger" style="margin-left: 10px;">完成</a>
</div>
</form>
{/block}

{block name="myjs"}
<script>
  layui.use('form', function(){
    var form = layui.form;
    form.on('select(school_id)', function(data){
    // 声明变量
    var school_id = data.value;
    var nianji = "<?php echo json_encode($list['data']['nianjiNum']);?>";
      // 获取数据
      $.post(
        "/teach/banji/mybanjis",
        {
          "school_id":school_id
          ,"ruxuenian":eval(nianji)
        },
        function(data,status){
          $('input[title="全选"]').each(function(){
            $(this).nextAll().remove();
          });
          $('input[title="全选"]').prop('checked',false);
          if($.isEmptyObject(data))
          {
            return true;
          }
          for (var i in data) {
                  // $('#'+data[i]['ruxuenian']).nextAll().remove();
                  for(x in data[i]['njBanji']){
                    $('#'+data[i]['ruxuenian']).append('<input type="checkbox" name="banji_id[]" value="'+data[i]['njBanji'][x]['id']+'" title="'+data[i]['njBanji'][x]['banTitle']+'" lay-skin="primary" checkall="c">');
                  }
                }
                form.render('checkbox');
              }
              );
    });
});

  function nextSet()
  {
    //先得到当前iframe层的索引
    var index = parent.layer.getFrameIndex(window.name);
    //再执行关闭
    if(parent.layui.table){
      parent.layui.table.reload('mytable');
    }
    parent.layer.close(index);
    parent.layer.msg('考试创建完成');
    return false;
  }

</script>
{/block}

