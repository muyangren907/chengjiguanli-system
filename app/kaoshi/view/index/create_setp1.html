{extend name=".././view/create.html" /}
{block name="jscss"}
  <style>
    .dh {
      min-height:50px;
      size:24px;
      padding-top:10px;
      text-align:center;
      min-height: 30px;
      float: left;
      margin-right: 1px;
    }
    .wancheng {
      border-bottom: 3px solid #01AAED;
    }

    .jinxing {
      border-bottom: 3px solid #FF5722;
    }

    .weicaozuo {
      border-bottom: 3px solid #FFB800;
    }
  </style>
{/block}
{block name="form"}
    <div class="layui-form-item">
      <div class="dh wancheng" style="width: 10%;">开始</div>
      <div class="dh jinxing" style="width: 20%;">考试信息</div>
      <div class="dh weicaozuo" style="width: 30%;">各年级参加考试学科和分数线</div>
      <div class="dh weicaozuo" style="width: 30%;">生成参加考试学生名单</div>
      <div class="dh weicaozuo" style="width: 9%;">完成</div>
    </div>

    <form class="layui-form layui-form-pane" lay-filter="myform">
          <div class="layui-form-item">
            <label for="zuzhi" class="layui-form-label"><span class="x-red">*</span>组织单位</label>
            <div class="layui-input-block">
              {php} $schoollist = kaoshiSchoolList();{/php}
              <select name="zuzhi_id" lay-verify="required">
                <option value=""></option>
                {volist name="schoollist" id="vo"}
                  <option value="{$vo.id}">
                    {$vo.title}
                  </option>
                {/volist}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
              <label for="title" class="layui-form-label">
                  <span class="x-red">*</span>考试名称
              </label>
              <div class="layui-input-block">
                  <input type="text" id="title" name="title" lay-verify="required"
                  autocomplete="off" class="layui-input " value="{$list.data.title|default=''}" placeholder="2-25个字符">
              </div>
          </div>
          <div class="layui-form-item">
            <label for="xueqi_id" class="layui-form-label"><span class="x-red">*</span>学期</label>
            <div class="layui-input-block">
              {php}
                $xueqi = new \app\teach\model\Xueqi;
                $xueqilist = $xueqi
                      ->limit(6)
                      ->order(['id'=>'desc'])
                      ->field('id,title')
                      ->select();
              {/php}
              <select name="xueqi_id" lay-verify="required">
                <option value=""></option>
                {volist name="xueqilist" id="vo"}
                  <option value="{$vo.id}">
                    {$vo.title}
                  </option>
                {/volist}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <label for="category_id" class="layui-form-label"><span class="x-red">*</span>考试分类</label>
            <div class="layui-input-block">
              {php} $category = categoryChildren(109);{/php}
              <select name="category_id" lay-verify="required">
                <option value=""></option>
                {volist name="category" id="vo"}
                  <option value="{$vo.id}">
                    {$vo.title}
                  </option>
                {/volist}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <div class="layui-inline">
              <label for="title" class="layui-form-label">
                <span class="x-red">*</span>考试时间
              </label>
              <div class="layui-input-inline">
                  <input type="text" class="layui-input" id="bfdate" name="bfdate" placeholder="开始时间" value="" autocomplete="off">
              </div>
              <div class="layui-input-inline">
                  <input type="text" class="layui-input" id="enddate" name="enddate" placeholder="结束时间" value="" autocomplete="off">
              </div>
            </div>
          </div>
          <div class="layui-form-item">
            <label for="fanwei_id" class="layui-form-label"><span class="x-red">*</span>查看范围</label>
            <div class="layui-input-block">
              {php} $category = categoryChildren(124);{/php}
              <select name="fanwei_id" lay-verify="required">
                <option value=""></option>
                {volist name="category" id="vo"}
                  <option value="{$vo.id}">
                    {$vo.title}
                  </option>
                {/volist}
              </select>
            </div>
          </div>
          <div class="layui-form-item" style="text-align: right;">
              <button  class="layui-btn" lay-filter="nextsubmit" lay-submit="">
                  {$list.set.butname}
              </button>
          </div>
      </form>
{/block}

{block name="myjs"}
<script>
  layui.use(['laydate','form','cjgl'], function(){
    var laydate = layui.laydate;
    //开始时间
    laydate.render({
      elem: '#bfdate'
      ,type: 'datetime'
      ,trigger: 'click' //采用click弹出
      ,min: 0 //今天
      ,max: 20 //20天后
      ,format: 'yyyy-M-d' //可任意组合
    });
    //结束时间
    laydate.render({
      elem: '#enddate'
      ,type: 'datetime'
      ,trigger: 'click' //采用click弹出
      ,min: 0 //今天
      ,max: 20 //20天后
      ,format: 'yyyy-M-d' //可任意组合
    });

    //监听提交
    form.on('submit(nextsubmit)', function(data){
      $.ajax({
        url:"{$list.set.url}",
        type:"{$list.set.formpost}",
        data:data.field,
        dataType:'json',
        success:function(result){
          if(result.val == 1)
          {
            $(location).attr('href', '/kaoshi/index/setp2/' + result.kaoshi_id);
          }else{
            layer.msg(result.msg);
          }
        },
        error:function(xhr,status,error) {
          layer.msg('数据处理错误',{
              icon: 2,
              time: 2000 //2秒关闭（如果不配置，默认是3秒）
          });
        }
      });
      return false;
    });

  });

</script>
{/block}

