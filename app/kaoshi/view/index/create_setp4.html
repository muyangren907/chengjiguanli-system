{extend name=".././view/create.html" /}

{block name="jscss"}
  <style>
    .dh {
      min-height:50px;
      size:24px;
      padding-top:10px;
      text-align:center;
      min-height: 30px;
      float: left;
      margin-right: 1px;
    }
    .wancheng {
      border-bottom: 3px solid #01AAED;
    }

    .jinxing {
      border-bottom: 3px solid #FF5722;
    }

    .weicaozuo {
      border-bottom: 3px solid #FFB800;
    }
    
    .srcSelectStyly{
      /*margin-top:20px;*/
      border-width: 1px;
      border-color:#e2e2e2;
      border-style:solid;
      background-color:#ffffff;
      position:absolute;
      left:0;
      right:0;
      z-index:100;
    }

    .srcSelectStyly dl{
      padding-top: 3px;
      padding-left: 6px;
      background-color:#ffffff;
    }

    .srcSelectStyly dd{
      /*margin-bottom: 3px;*/
      /*background-color:#f2f2f2;*/
      height: 30px;
      padding-top: 10px;
    }

  </style>
{/block}

{block name="form"}
<div class="layui-form-item">
  <div class="dh wancheng" style="width: 10%;">开始</div>
  <div class="dh wancheng" style="width: 20%;">考试信息</div>
  <div class="dh wancheng" style="width: 20%;">各年级参加考试学科和分数线</div>
  <div class="dh wancheng" style="width: 20%;">生成参加考试学生名单</div>
  <div class="dh jinxing" style="width: 20%;">分配录入成绩任务</div>
  <div class="dh weicaozuo" style="width: 9%;">完成</div>
</div>
<form class="layui-form layui-form-pane" lay-filter="myform"> 
  <input id="kaoshi_id" name="kaoshi_id" value="{$list.set.kaoshi_id}" type="hidden">
  <div class="layui-form-item">
      <label for="cyselect" class="layui-form-label">
          <span class="x-red">*</span>教师
      </label>
      <div class="layui-inline">
        <div class="layui-input-inline">
          <input name="admin_id" id="admin_id" type="text" class="layui-input" autocomplete="off">
        </div>
        {present name="$list.data.kt_zcr"}
          {volist name="$list.data.kt_zcr" id="vo"}
          <div class="layui-input-inline" style="width:60px">
            <div onclick="cjgl.delTeacher(this)" class="layui-btn layui-btn-normal">
              {$vo.admin.xingming}
            </div>
            <input type="hidden" name="hjteachers[]" value="{$vo.admin.id}"></div>
          {/volist}
        {/present}
      </div>
  </div>
  <div class="layui-form-item">
    <label for="school_id" class="layui-form-label"><span class="x-red">*</span>学校</label>
    <div class="layui-input-block">
      <select name="school_id" id="school_id" lay-verify="required" lay-filter="school_id">
        <option value="">请选择学校</option>
      </select>
    </div>
  </div>
  <div class="layui-form-item">
    <label for="ruxuenian" class="layui-form-label">
      <span class="x-red">*</span>年级
    </label>
    <div class="layui-input-block">
      <select name="ruxuenian" id="ruxuenian" lay-verify="required" class="layui-form-label" lay-filter="ruxuenian">
        <option value="">请选择年级</option>
      </select>
    </div>
  </div>
  <div class="layui-form-item">
    <label for="banji_id" class="layui-form-label">
      <span class="x-red">*</span>班级
    </label>
    <div class="layui-input-block" id="banji_id">
    </div>
  </div>
  <div class="layui-form-item">
    <label for="subject_id" class="layui-form-label">
      <span class="x-red">*</span>学科
    </label>
    <div class="layui-input-block" id="subject_id">
    </div>
  </div>
  <div class="layui-form-item" style="text-align: right;">
      <button  class="layui-btn" lay-filter="mysubmit" lay-submit="">
          {$list.set.butname}
      </button>
  </div>
</form>
{/block}

{block name="myjs"}
<script>
  layui.use(['form','cjgl'], function(){
    var form = layui.form
        ,cjgl = layui.cjgl;

    // 加载学校列表
    addSchool();

    // 监听学校下拉菜单
    form.on('select(school_id)', function (data) {
      addNianji();
    })
    // 监听学校下拉菜单
    form.on('select(ruxuenian)', function (data) {
      addBanji();
      addSubject();
    })

    // 添加学校
    function addSchool(){
      // 获取参数
      formval = form.val("myform");
      cjgl.createSelectOption('school_id', formval, '/tools/kscy/school', 'id', 'title');
    }

    // 添加年级
    function addNianji(){
      // 获取参数
      formval = form.val("myform");
      cjgl.createSelectOption('ruxuenian', formval, '/tools/kscy/grade', 'ruxuenian', 'nianjiname');
    }

    // 添加学科
    function addBanji(){
      // 获取参数
      formval = form.val("myform");
      console.log(formval);
      cjgl.createCheckbox('banji_id', formval, '/tools/kscy/class', 'banji_id', 'banTitle');
    }


    // 添加学校
    function addSubject(){
      // 获取参数
      formval = form.val("myform");
      cjgl.createCheckbox('subject_id', formval, '/tools/kscy/subject', 'subject_id', 'title');
    }


    // 搜索教师
    $('#admin_id').bind({
      keyup:function(){
        var val = $.trim($(this).val());
        if(val.length>0){
          cjgl.searchTeacher(this, val, 'admin_id[]', 'addTeacher');
        }
      },
    })

});

  function nextSet()
  {
    //先得到当前iframe层的索引
    var index = parent.layer.getFrameIndex(window.name);
    //再执行关闭
    if(parent.layui.table){
      parent.layui.table.reload('mytable');
    }
    parent.layer.close(index);
    parent.layer.msg('考试创建完成');
    return false;
  }


  function preSet()
  {
    $(location).attr('href', '/kaoshi/index/setp3/' + "{$list['set']['kaoshi_id']}");
    return false;
  }

</script>
{/block}

