{extend name=".././view/create.html" /}

{block name="form"}
    <form class="layui-form layui-form-pane" lay-filter="myform">
          <div class="layui-form-item">
              <label for="cyselect" class="layui-form-label">
                  学生ID
              </label>
              <div class="layui-inline">
                <div class="layui-input-inline">
                  <input name="student" id="student" type="text" class="layui-input" autocomplete="off" readonly="true">
                </div>
              </div>
          </div>
          <div class="layui-form-item">
            <label for="school" class="layui-form-label"><span class="x-red">*</span>学校</label>
            <div class="layui-input-block">
              <select name="school" id="school" lay-verify="required">
                <option value=""></option>
                {foreach $list.data.school as $key=>$vo}
                  <option value="{$vo.id}"
                    {eq name="$key" value="0" }
                      selected
                    {/eq}>
                    {$vo.title}
                  </option>
                {/foreach}
              </select>
            </div>
          </div>
          <div class="layui-form-item">
            <label for="ruxuenian" class="layui-form-label">
              <span class="x-red">*</span>年级
            </label>
            <div class="layui-input-block">
              <select name="ruxuenian" id="ruxuenian" lay-verify="required" class="layui-form-label">
                {foreach $list.data.nianji as $key=>$vo}
                  <option value="{$vo.nianji}">{$vo.nianjiname}</option>
                {/foreach}
              </select>
            </div>
          </div>

          <div class="layui-form-item">
            <label for="banji" class="layui-form-label">
              <span class="x-red">*</span>班级
            </label>
            <div class="layui-input-block">
              <select name="banji" id="banji" lay-verify="required" class="layui-form-label">
                <option value=""></option>
              </select>
            </div>
          </div>
          <div class="layui-form-item" id="list">
              <label for="cyselect" class="layui-form-label">
                  <span class="x-red">*</span>搜索框
              </label>
              <div class="layui-inline">
                <div class="layui-input-inline">
                  <input name="search" id="search" type="text" class="layui-input" autocomplete="off">
                </div>
              </div>
          </div>
          <input type="hidden" name="kaoshi" id="kaoshi" value="{$list.set.kaoshi}">
          <div class="layui-form-item" style="text-align: right;">
              <button  class="layui-btn" lay-filter="mysubmit" lay-submit="">
                  {$list.set.butname}
              </button>
          </div>
      </form>
{/block}

{block name="myjs"}
<script>
  layui.use(['form','cjgl'], function(){
    var form = layui.form
        cjgl = layui.cjgl;


    addBanji();
    // 监听选择按钮
    form.on('select', function(data){
      var myselectname = $(data.elem).attr('name');
      if(myselectname == 'school' || myselectname == 'ruxuenian'){
        addBanji();
        form.render();
      }
    });


    function addBanji()
    {
      // 获取参数
      formval = form.val("myform");
      cjgl.createSelectOption('banji',formval,'/teach/banji/mybanji','id','banTitle');
      console.log(formval);
    }
    

    // 搜索教师
    $('#search').bind({
      keyup:function(){
        str = $('#search').val().trim();
        banji = $('#banji').val();
        if(banji=='')
        {
          layer.msg('先选择班级');
          return true;
        }
        // 获取数据
        $.post(
            "/renshi/student/srcstudent",
            {
                "str":str,
                "banji":banji
            },
            function(data,status){
                
                if($.isEmptyObject(data))
                {
                    return true;
                }
                for (var i = data.length - 1; i >= 0; i--) {
                  $('#list').append('<span name="aa" onclick="addStudent(this)" name="srcjg" class="layui-btn layui-btn-normal" stuid="'+data[i].id+'" stuname="'+data[i].xingming+'">'+data[i].xingming+' </span>');
                }
            }
        );
      }
    })
  });



  // 添加学生
  function addStudent(obj)
  {
    studentid = $(obj).attr('stuid');
    studentname = $(obj).attr('stuname');
    $(student).val(studentname + ' ' +studentid);
    $("span[name='aa']").remove();
    $("#search").val('');
  }


</script>
{/block}

