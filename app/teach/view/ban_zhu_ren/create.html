{extend name=".././view/create.html" /}
{block name="jscss"}
<style type="text/css">
  .srcSelectStyly{
    /*margin-top:20px;*/
    border-width: 1px;
    border-color:#e2e2e2;
    border-style:solid;
    background-color:#ffffff;
    position:absolute;
    left:0;
    right:0;
    z-index:100;
  }
  .srcSelectStyly dl{
    padding-top: 3px;
    padding-left: 6px;
    background-color:#ffffff;
  }
  .srcSelectStyly dd{
    /*margin-bottom: 3px;*/
    /*background-color:#f2f2f2;*/
    height: 30px;
    padding-top: 10px;
  }
</style>
{/block}
{block name="form"}
    <form class="layui-form layui-form-pane" lay-filter="myform">
          <div class="layui-form-item">
              <label for="teacher_id" class="layui-form-label">
                  <span class="x-red">*</span>教师姓名
              </label>
              <div class="layui-inline">
                <div class="layui-input-inline">
                  <input name="teacher_id" id="teacher_id" type="text" class="layui-input" autocomplete="off" placeholder="多选取第一个">
                </div>
                {present name="$list.data.kt_zcr"}
                  {volist name="$list.data.kt_zcr" id="vo"}
                  <div class="layui-input-inline" style="width:60px">
                    <div onclick="cjgl.delTeacher(this)" class="layui-btn layui-btn-normal">
                      {$vo.teacher.xingming}
                    </div>
                    <input type="hidden" name="teacher_id[]" value="{$vo.teacher.id}"></div>
                  {/volist}
                {/present}
              </div>
          </div>
          <div class="layui-form-item">
              <label for="bfdate" class="layui-form-label">
                  接任时间
              </label>
              <div class="layui-input-block">
                  <input type="text" id="bfdate" name="bfdate" autocomplete="off" class="layui-input " value="{$list.data.bfdate|default=''}" placeholder="接到这个任务的开始时间">
              </div>
          </div>
          <input name="banji_id" id="banji_id" value="{$list.data.banji_id}" type="hidden">
          <input name="school_id" id="school_id" value="{$list.data.school_id}" type="hidden">
          <div class="layui-form-item" style="text-align: right;">
              <button  class="layui-btn" lay-filter="mysubmit" lay-submit="">
                  {$list.set.butname}
              </button>
          </div>
      </form>
{/block}

{block name="myjs"}
<script>

  var cjgl = parent.layui.cjgl;
  var tempTeacherName = '';
  var tempTeacherid = ''

  $("[name^='xingming']").each(function(){

    $(this).bind("focus", function(){
      myFocus(this);
    });

    $(this).bind("blur", function(){
      myBlur(this);
    });

    $(this).bind("keyup", function(){
      srcTeacher(this);
    });

  });

  function srcTeacher(obj)
  {
    id = myId(obj);
    var val = $.trim($(obj).val());
    var school_id = $('#school_id').val();
    if(school_id <= 0)
    {
      layer.msg('请选选择学校');
      return true;
    }
    if(val.length > 0){
      // 获取数据
      $.post(
          "/admin/index/srcteacher",
          {
              "str": val,
              'school_id':school_id
          },
          function(data,status){
              data = data.data;
              $('#src' + id).children().remove();
              if($.isEmptyObject(data))
              {
                  return true;
              }
              for (var i = data.length - 1; i >= 0; i--) {
                $('#src' + id).append('<span onclick="addTeacher(this)" class="layui-btn layui-btn-normal" teacher_id="'+data[i].id+'" rowid="'+id+'" xingming="'+data[i].xingming+'">'+data[i].xingming+' </span>');
              }
          }
      );
    } else {
      $('#src' + id).children().remove();
    }
  }


  function myFocus(obj)
  {
    id = myId(obj);
    $(obj).val('');
    $('#teacher_id' + id).val('');
  }


  function myBlur(obj)
  {
    val = $(obj).val();
    id = myId(obj);

    if($('#teacher_id' + id).val() == '')
    {
      $(obj).val('');
    }
  }


  function myId(obj)
  {
    id = $(obj).attr('id');
    id = id.replace(/[^0-9]/ig, "");
    return id;
  }


  function addTeacher(obj)
  {
    teacher_id = $(obj).attr('teacher_id');
    xingming = $(obj).attr('xingming');
    rowid = $(obj).attr('rowid');
    $('#teacher_id' + rowid).val(teacher_id);
    $('#xingming' + rowid).val(xingming);
    $('#src' + rowid).children().remove();
  }


  // 日期控件
layui.use(['form','upload','cjgl','laydate'], function(){
    var form = layui.form
        ,cjgl = layui.cjgl
        ,laydate = layui.laydate;

    //执行一个laydate实例
    laydate.render({
      elem: '#bfdate' //指定元素
      ,trigger: 'click' //采用click弹出
    });

  // 搜索教师
  $('#teacher_id').bind({
    keyup:function(){
      var val = $.trim($(this).val());
      if(val.length>0){
        cjgl.searchTeacher(this, val, 'teacher_id[]', 'addTeacher');
      }
    },
  })
   
});

</script>
{/block}

