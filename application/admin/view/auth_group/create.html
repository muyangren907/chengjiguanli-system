{extend name="common@create" /}

{block name="form"}
    <form class="layui-form layui-form-pane" lay-filter="myform">
          <div class="layui-form-item">
              <label for="title" class="layui-form-label">
                  <span class="x-red">*</span>角色名称
              </label>
              <div class="layui-input-block">
                  <input type="text" id="title" name="title" lay-verify="required"
                  autocomplete="off" class="layui-input " value="{$list.data.title|default=''}" placeholder="中文2-25个字符">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="title" class="layui-form-label">
                  <span class="x-red">*</span>角色描述
              </label>
              <div class="layui-input-block">
                  <input type="text" id="title" name="title" lay-verify="required"
                  autocomplete="off" class="layui-input " value="{$list.data.title|default=''}" placeholder="中文2-25个字符">
              </div>
          </div>
          {php}
            $authrule = new \app\admin\model\AuthRule;
            $authrulelist = $authrule->all();
          {/php}
          <div class="layui-form-item">
              {volist name="authrulelist" id="vo"}
                <div style="background: #eeeeee">
                  <input type="checkbox" name="rules" title="{$vo.title}" value="{$vo.id}" lay-skin="primary" id ="{$vo.id}" pid="0" action="topOnclick">
                </div>
                <div class="layui-form-item" id="{$vo.id}" style="padding-left: 10px;padding-right: 10px;">
                  {volist name="vo.auth_cid" id="vc"}
                    <div>
                      <input type="checkbox" name="rules" title="{$vc.title}" value="{$vc.id}" lay-skin="primary" id ="{$vc.id}" pid="{$vo.id}" action="midOnclick">
                      {volist name="vc.auth_cid" id="vd"}
                        <input type="checkbox" name="rules" title="{$vd.title}" value="{$vd.id}" lay-skin="primary" id ="{$vd.id}" pid="{$vc.id}" action="btmOnclick">
                      {/volist}
                    </div>
                  {/volist}
                </div>
              {/volist}
          </div>  
          <div class="layui-form-item" style="text-align: right;">
              <button  class="layui-btn" lay-filter="mysubmit" lay-submit="">
                  {$list.set.butname}
              </button>
          </div>
      </form>
{/block}

{block name="myjs"}
    <script type="text/javascript">

      // 监测复选框按钮
      layui.use(['form'], function(){
        var form = layui.form;
        form.on('checkbox()', function(data){
          var myelem = data.elem
            ,ischecked = data.elem.checked
            ,action = $(myelem).attr('action')
            ,pid = $(myelem).attr('pid')
            ,id = $(myelem).attr('id');
          switch(action){
            case 'topOnclick':
              topOnclick(id,ischecked)
              break;
            case 'midOnclick':
              midOnclick(id,pid,ischecked);
              break;
            case 'btmClick':
              cjgl.add('添加单位','/school/create','650','500');
              break;
          };
        });        
      });

      // 顶层按钮
      function topOnclick(id,ischecked)
      {
        if(ischecked == true){
          $('#'+id).parent().next().find('div.layui-form-checkbox').each(function(){
            $(this).attr('class','layui-unselect layui-form-checkbox layui-form-checked')
          });
        }else{
          $('#'+id).parent().next().find('div.layui-form-checkbox').each(function(){
            $(this).attr('class','layui-unselect layui-form-checkbox')
          });
        }
      }

      // 中层按钮
      function midOnclick(id,pid,ischecked)
      {
        if(ischecked == true){
          $('#'+id).parent().parent().prev().find('div.layui-form-checkbox').each(function(){
            $(this).attr('class','layui-unselect layui-form-checkbox layui-form-checked')
          });
          $('#'+id).siblings('div.layui-form-checkbox').each(function(){
            $(this).attr('class','layui-unselect layui-form-checkbox layui-form-checked')
          });
        }else{
          // $('#'+id).parent().parent().prev().find('div.layui-form-checkbox').each(function(){
          //   $(this).attr('class','layui-unselect layui-form-checkbox layui-form-checked')
          // });
          $('#'+id).siblings('div.layui-form-checkbox').each(function(){
            $(this).attr('class','llayui-unselect layui-form-checkbox')
          });
          var checkboxs = $('#'+id).parent().parent().find('div.layui-form-checkbox').lenght;

          each(function(){
            $(this).attr('class','layui-unselect layui-form-checkbox layui-form-checked')
          });
        }
      }



      


    </script>
{/block}

